

# План: Анимация "раскрытия" деталей внутри контейнера

## Концепция UX

**Метафора**: При включении галочек "Команды" / "Инициативы" пользователь раскрывает внутреннюю структуру юнита. Анимация должна передавать, что детали **проявляются изнутри** контейнера, а не "прилетают откуда-то".

**Решение**: Fade + Scale from Center — элементы появляются из своего центра с лёгким масштабированием (0.85 → 1.0), создавая эффект "раскрытия".

---

## Техническая реализация

### Изменение в `TreemapNode.tsx`

Текущий код:
```typescript
initial={animationType === 'initial' ? false : { opacity: 0 }}
animate={{ 
  opacity: 1,
  x,
  y,
  width: node.width,
  height: node.height,
}}
```

Новый код:
```typescript
initial={animationType === 'initial' ? false : { opacity: 0, scale: 0.85 }}
animate={{ 
  opacity: 1,
  scale: 1,
  x,
  y,
  width: node.width,
  height: node.height,
}}
exit={{ opacity: 0, scale: 0.85 }}
style={{
  position: 'absolute',
  backgroundColor: node.color,
  borderRadius: 4,
  overflow: 'hidden',
  cursor: 'pointer',
  border: '1px solid rgba(255,255,255,0.3)',
  transformOrigin: 'center center',  // Ключевое: масштабирование от центра
}}
```

### Настройка transition для плавности

```typescript
transition={{ 
  duration,
  ease: [0.25, 0.1, 0.25, 1],
  scale: { duration: duration * 0.8 },  // Scale чуть быстрее для "упругости"
}}
```

---

## Визуализация эффекта

```text
БЫЛО (появление из угла 0,0):
┌─────────────────┐
│ Unit            │
│ ┌──→→→→→→→→→┐   │  ← Team "растягивается" из левого верхнего угла
│ │           │   │
│ └───────────┘   │
└─────────────────┘

СТАНЕТ (раскрытие из центра):
┌─────────────────┐
│ Unit            │
│      ╔═══╗      │  ← Team "раскрывается" из своего центра
│      ║ → ║      │
│      ╚═══╝      │
│   ↙         ↘   │
│ ┌───────────┐   │
│ │   Team    │   │
│ └───────────┘   │
└─────────────────┘
```

---

## Файлы для изменения

| Файл | Изменение |
|------|-----------|
| `TreemapNode.tsx` | Добавить `scale` в initial/animate/exit, установить `transformOrigin: 'center center'` |

---

## Ожидаемый результат

1. При включении галочек детали **плавно раскрываются** из центра каждого элемента
2. Юнит/стейкхолдер остаётся визуально стабильным — меняется только содержимое
3. Когнитивная связь сохраняется: "я раскрываю структуру этого контейнера"
4. При выключении галочек — обратный эффект "сворачивания" обратно в центр

---

## Оценка

| Метрика | Значение |
|---------|----------|
| Сложность | Очень низкая |
| Файлов изменится | 1 |
| Риск регрессии | Минимальный |
| Улучшение UX | Значительное |

