
# –ü–ª–∞–Ω: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ D3 Treemap (–Ω–∞–∑–≤–∞–Ω–∏—è + –∞–Ω–∏–º–∞—Ü–∏–∏)

## –ü—Ä–æ–±–ª–µ–º—ã –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ—Ç–µ—Ä—è–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è —é–Ω–∏—Ç–æ–≤/–∫–æ–º–∞–Ω–¥ –ø—Ä–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
**–ü—Ä–∏—á–∏–Ω–∞**: –í D3 layer –∫–æ–Ω—Ç–µ–Ω—Ç —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç—Å—è (`justify-content: center`), –Ω–µ—Ç –ª–æ–≥–∏–∫–∏ "sticky header" –¥–ª—è —É–∑–ª–æ–≤ —Å –¥–µ—Ç—å–º–∏.

**–†–µ—à–µ–Ω–∏–µ**: 
- –ï—Å–ª–∏ —É —É–∑–ª–∞ –µ—Å—Ç—å `children` ‚Üí —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å label –∫–∞–∫ **header –≤–≤–µ—Ä—Ö—É** (position: absolute, top: 0)
- –ï—Å–ª–∏ —É–∑–µ–ª leaf ‚Üí —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –ø–æ —Ü–µ–Ω—Ç—Ä—É –∫–∞–∫ —Å–µ–π—á–∞—Å

**–°–¢–ê–¢–£–°**: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (–ò—Ç–µ—Ä–∞—Ü–∏—è 1)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Drilldown –∞–Ω–∏–º–∞—Ü–∏—è –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
**–ü—Ä–∏—á–∏–Ω–∞**: Race condition –≤ `TreemapContainer.tsx`:
- `prevLayoutNodesRef.current` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `useEffect` –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
- –ö –º–æ–º–µ–Ω—Ç—É exit-–∞–Ω–∏–º–∞—Ü–∏–∏, D3 —É–∂–µ –ø–æ–ª—É—á–∏–ª –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- `zoomTarget.key` –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–µ–¥–∏ exiting nodes (—Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏)

**–†–µ—à–µ–Ω–∏–µ**:
- –•—Ä–∞–Ω–∏—Ç—å snapshot –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É–∑–ª–æ–≤ –î–û –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ D3 layer –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π prop `exitingNodes`
- D3 —Å–Ω–∞—á–∞–ª–∞ –∞–Ω–∏–º–∏—Ä—É–µ—Ç exit —Å—Ç–∞—Ä—ã—Ö —É–∑–ª–æ–≤, –ø–æ—Ç–æ–º enter –Ω–æ–≤—ã—Ö

**–°–¢–ê–¢–£–°**: üîÑ –°–õ–ï–î–£–Æ–©–ê–Ø –ò–¢–ï–†–ê–¶–ò–Ø

## –ò—Ç–µ—Ä–∞—Ü–∏–∏

### –ò—Ç–µ—Ä–∞—Ü–∏—è 1: Header –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
1. ‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å `TreemapD3Layer.tsx`:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generateNodeContent()`
   - –ï—Å–ª–∏ `d.children && d.children.length > 0` ‚Üí header –≤–≤–µ—Ä—Ö—É (position: absolute, top: 4px)
   - –ï—Å–ª–∏ leaf ‚Üí –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É (position: absolute, top: 50%, transform: translate(-50%, -50%))
   
### –ò—Ç–µ—Ä–∞—Ü–∏—è 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ drilldown –∞–Ω–∏–º–∞—Ü–∏–∏ (–°–õ–ï–î–£–Æ–©–ê–Ø)
1. –ò–∑–º–µ–Ω–∏—Ç—å `TreemapContainer.tsx`:
   - –•—Ä–∞–Ω–∏—Ç—å `exitingNodesRef` –æ—Ç–¥–µ–ª—å–Ω–æ
   - –û–±–Ω–æ–≤–ª—è—Ç—å –µ–≥–æ –ü–ï–†–ï–î –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º `layoutNodes`
   - –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ `TreemapD3Layer` –∫–∞–∫ prop
2. –ò–∑–º–µ–Ω–∏—Ç—å `TreemapD3Layer.tsx`:
   - –ü—Ä–∏ drilldown: —Å–Ω–∞—á–∞–ª–∞ –∞–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å exit –∏–∑ `exitingNodes`, –ø–æ—Ç–æ–º enter –Ω–æ–≤—ã—Ö
   - –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏

### –ò—Ç–µ—Ä–∞—Ü–∏—è 3: Polish –∏ cleanup
1. –£–¥–∞–ª–∏—Ç—å debug-–∫–æ–¥ –∏–∑ `TreemapNode.tsx`
2. –£–¥–∞–ª–∏—Ç—å —Å–∞–º `TreemapNode.tsx` (deprecated)
3. –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ timing –∏ easing

## –û—Ü–µ–Ω–∫–∞

| –ê—Å–ø–µ–∫—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ | 1-2 |
| –ö—Ä–µ–¥–∏—Ç—ã | 5-10 |
| –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ push-–∞–Ω–∏–º–∞—Ü–∏–∏ | 80-85% |

## –†–∏—Å–∫–∏
- **–°—Ä–µ–¥–Ω–∏–π**: Timing –º–µ–∂–¥—É exit –∏ enter –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ—Ç–ª–∞–¥–∫–∏
- **–ù–∏–∑–∫–∏–π**: –í–∏–∑—É–∞–ª—å–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è header-–æ–≤ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ Framer Motion –∫–æ–¥–∞
