
# –ü–ª–∞–Ω: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –≤ Treemap

## –°—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
–î–æ–±–∞–≤–∏—Ç—å –≤ tooltip treemap-–∞ –¥–≤–∞ –Ω–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è:
1. **% –æ—Ç –Æ–Ω–∏—Ç–∞** ‚Äî –¥–æ–ª—è –±—é–¥–∂–µ—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —é–Ω–∏—Ç–∞
2. **% –æ—Ç –í—Å–µ–≥–æ** ‚Äî –¥–æ–ª—è –±—é–¥–∂–µ—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–±—â–µ–π —Å—É–º–º—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ

## –ì–¥–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã

–ü—Ä–æ—Ü–µ–Ω—Ç—ã –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –≤ tooltip –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –ª—é–±–æ–π —ç–ª–µ–º–µ–Ω—Ç treemap-–∞ (—é–Ω–∏—Ç, –∫–æ–º–∞–Ω–¥–∞, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞), —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ "–ë—é–¥–∂–µ—Ç":

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Data Office                     üü¢  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ë—é–¥–∂–µ—Ç              331.4 –º–ª–Ω ‚ÇΩ    ‚îÇ
‚îÇ % –æ—Ç –Æ–Ω–∏—Ç–∞          45.2%          ‚îÇ  ‚Üê –Ω–æ–≤–æ–µ
‚îÇ % –æ—Ç –í—Å–µ–≥–æ          18.7%          ‚îÇ  ‚Üê –Ω–æ–≤–æ–µ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ü–ª–∞–Ω –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–≤–∞—Ä—Ç–∞–ª...       ‚îÇ
‚îÇ ...                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –§–æ—Ä–º—É–ª–∞ | –ü–æ—è—Å–Ω–µ–Ω–∏–µ |
|---------|---------|-----------|
| % –æ—Ç –Æ–Ω–∏—Ç–∞ | `(nodeValue / unitValue) √ó 100` | –î–æ–ª—è –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —é–Ω–∏—Ç–∞ (–¥–ª—è —Å–∞–º–∏—Ö —é–Ω–∏—Ç–æ–≤ = 100%) |
| % –æ—Ç –í—Å–µ–≥–æ | `(nodeValue / totalValue) √ó 100` | –î–æ–ª—è –æ—Ç —Å—É–º–º—ã `data.value` (–∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞) |

## –ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `src/components/BudgetTreemap.tsx` | –†–∞—Å—á—ë—Ç –∏ –≤—ã–≤–æ–¥ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `showTooltip` |
| `src/components/StakeholdersTreemap.tsx` | –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è Stakeholders treemap |
| `src/styles/treemap.css` | –°—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ (–∏—Å–ø–æ–ª—å–∑—É—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `.tooltip-row`) |

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. BudgetTreemap.tsx

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `showTooltip`:**

```typescript
const showTooltip = (e: MouseEvent, nodeData: TreeNode, nodeValue: number, unitValue: number) => {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
  
  // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã
  const totalValue = root.value || 1; // –û–±—â–∞—è —Å—É–º–º–∞ (—É–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ scope)
  const percentOfUnit = unitValue > 0 ? ((nodeValue / unitValue) * 100).toFixed(1) : '100.0';
  const percentOfTotal = totalValue > 0 ? ((nodeValue / totalValue) * 100).toFixed(1) : '0.0';
  
  // –î–æ–±–∞–≤–ª—è–µ–º –≤ HTML –ø–æ—Å–ª–µ –±—é–¥–∂–µ—Ç–∞:
  html += `<div class="tooltip-row">
    <span class="tooltip-label">% –æ—Ç –Æ–Ω–∏—Ç–∞</span>
    <span class="tooltip-value">${percentOfUnit}%</span>
  </div>`;
  html += `<div class="tooltip-row">
    <span class="tooltip-label">% –æ—Ç –í—Å–µ–≥–æ</span>
    <span class="tooltip-value">${percentOfTotal}%</span>
  </div>`;
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `renderNode`:**

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `showTooltip` –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —é–Ω–∏—Ç–∞. –î–ª—è —ç—Ç–æ–≥–æ:
- –ü–æ–¥–Ω–∏–º–µ–º—Å—è –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –¥–æ —É–∑–ª–∞ depth=0 (—é–Ω–∏—Ç)
- –ü–µ—Ä–µ–¥–∞–¥–∏–º –µ–≥–æ `.value` –≤ `showTooltip`

```typescript
// –ù–∞–π—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —é–Ω–∏—Ç–∞
let unitNode = node;
while (unitNode.parent && unitNode.depth > 1) {
  unitNode = unitNode.parent;
}
const unitValue = unitNode.value || nodeValue;

// –í—ã–∑–æ–≤ showTooltip —Å unitValue
showTooltip(e, node.data, node.value || 0, unitValue);
```

### 2. StakeholdersTreemap.tsx

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- –î–ª—è Stakeholders treemap top-level ‚Äî —ç—Ç–æ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä, –ø–æ—ç—Ç–æ–º—É "% –æ—Ç –Æ–Ω–∏—Ç–∞" –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è "% –æ—Ç –°—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞"
- –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∞

### 3. –î–æ—Å—Ç—É–ø –∫ `root.value`

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `root` (—Ä–µ–∑—É–ª—å—Ç–∞—Ç `d3.hierarchy`) —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â—É—é —Å—É–º–º—É –≤ `root.value`. –û–Ω–∞ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ scope —Ñ—É–Ω–∫—Ü–∏–∏ `renderTreemap`, –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞—Ç—å –µ—ë –≤ `showTooltip`.

**–í–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `totalValue = root.value` –≤ –∑–∞–º—ã–∫–∞–Ω–∏–∏
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –µ–≥–æ –≤ `showTooltip` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é

---

## –ò—Ç–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π

1. **BudgetTreemap.tsx** (~15 —Å—Ç—Ä–æ–∫):
   - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `showTooltip` –¥–ª—è –ø—Ä–∏—ë–º–∞ `unitValue` –∏ `totalValue`
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á—ë—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å 2 —Å—Ç—Ä–æ–∫–∏ HTML –≤ tooltip
   - –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤ `showTooltip` –≤ `renderNode`

2. **StakeholdersTreemap.tsx** (~15 —Å—Ç—Ä–æ–∫):
   - –¢–µ –∂–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ —Å –ª–µ–π–±–ª–æ–º "% –æ—Ç –°—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞"

3. **CSS** ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ `.tooltip-row`)
